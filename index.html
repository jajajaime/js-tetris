<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tetris</title>

    <style>
        .board{
            border: 1px solid black;
            position: relative;
        }
        .piece{
            position: absolute;
            background-color: red;
        }
    </style>
</head>
<body>
    <div class="board"></div>

    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"
        integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc="
        crossorigin="anonymous"></script>
    <script>
        var colors = ['red', 'green', 'blue', 'yellow', 'black', 'purple', 'grey'],
        block =
        {
            width: 30, // px
            height: 30 // px
        },
        pieces =
        {
            "I":{
                width: (1 * block.width) + 'px',
                height: (4 * block.height) + 'px'
            },
            "J":{
                width: (2 * block.width) + 'px',
                height: (3 * block.height) + 'px'
            },
            "L":{
                width: (2 * block.width) + 'px',
                height: (3 * block.height) + 'px'
            },
            "O":{
                width: (2 * block.width) + 'px',
                height: (2 * block.height) + 'px'
            },
            "S":{
                width: (3 * block.width) + 'px',
                height: (3 * block.height) + 'px'
            },
            "T":{
                width: (3 * block.width) + 'px',
                height: (3 * block.height) + 'px'
            },
            "Z":{
                width: (3 * block.width) + 'px',
                height: (3 * block.height) + 'px'
            }
        },
        board =
        {
            width: (10 * block.width) + 'px',
            height: (16 * block.height) + 'px'
        };

        $('.board').css({
            'width': board.width,
            'height': board.height
        });

        var movingPiece = false;
        var piece,
            pieceDiv;

        $('body').keyup(function(e)
        {
            if(e.keyCode == 37) // left
            {
                left = parseInt(pieceDiv.css('left'));
                left = (left - block.width);
                if(left < 0)
                {
                    return;
                }

                pieceDiv.css('left', left + 'px');
            }
            else if(e.keyCode == 39) // right
            {
                left = parseInt(pieceDiv.css('left'));
                left = (left + block.width);
                if(left > parseInt(board.width, 10) - parseInt(pieces[piece].width, 10))
                {
                    return;
                }

                pieceDiv.css('left', left + 'px');
            }
        });

        main();
        setInterval(function()
        {
            main();
        }, 1000);


        function main()
        {
            if(!movingPiece)
            {
                window.console && console.log('not moving')
                piece = randomPiece();
                window.console && console.log(piece);
                window.console && console.log(pieces[piece]);

                pieceDiv = $('<div>')
                    .addClass('piece')
                    .css({
                        'width': pieces[piece].width,
                        'height': pieces[piece].height,
                        'top': 0,
                        'left': 0,
                        'backgroundColor': randomColor()
                    });

                $('.board').append(pieceDiv);

                movingPiece = true;
            }
            else
            {
                pieceDiv.css({'top': (parseInt(pieceDiv.css('top'), 10) + block.height) + 'px'});

                if(pieceDiv.css('top') == (parseInt(board.height, 10) - parseInt(pieces[piece].height, 10)) + 'px')
                {
                    movingPiece = false;
                }
            }

        }


        // Select a random piece
        function randomPiece()
        {
            var keys = Object.keys(pieces)
            return keys[keys.length * Math.random() << 0];
            return pieces[keys[ keys.length * Math.random() << 0 ] ];
        }

        // Select a color
        function randomColor()
        {
            return colors[colors.length * Math.random() << 0]
        }
    </script>
</body>
</html>